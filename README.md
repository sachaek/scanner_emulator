## Эмулятор сканера штрих‑кодов (PyQt5)

Графическое приложение для эмуляции ввода штрих‑кодов с клавиатуры. Позволяет:
- эмулировать «сканирование» — по введённой строке приложению имитируются нажатия клавиш, как от физического сканера;
- распознавать штрих‑коды/Datamatrix с изображений: из файла и из снимка экрана (буфер обмена), с помощью `pyrxing`.

### Основные возможности
- Настраиваемые задержки эмуляции ввода: перед стартом, для первого символа, между символами, удержание клавиши.
- Проверка максимальной длины кода перед эмуляцией.
- Распознавание кода из изображения файла и из изображения в буфере обмена.
- Светлая/тёмная тема (сохраняется между запусками).
- Сохранение пользовательских настроек в профиле пользователя (не рядом с исполняемым файлом).

## Интерфейс
Главное окно содержит:
- поле «Введите штрих‑код»;
- кнопку «Сканировать» — эмулирует набор символов и Enter в активном окне;
- кнопку «Barcode из файла» — выбрать изображение и распознать код;
- кнопку «Barcode из снимка экрана» — взять изображение из буфера обмена и распознать код;
- меню: «Параметры → Параметры сканирования» (настройка задержек и длины), «Настройки → Стиль» (светлая/тёмная тема).

Результаты распознавания: если найдено несколько кодов, в поле подставляется первый; дубликаты убираются.

## Зависимости

См. `requirements.txt`:
- PyQt5 — UI;
- pynput — эмуляция нажатий клавиш;
- pyrxing — распознавание штрих‑кодов по изображениям;
- pyinstaller — сборка standalone‑исполняемого файла (опционально).

## Установка и запуск из исходников

```bash
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt
python -m emu.main
```

Альтернатива для POSIX:
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python -m emu.main
```

Готовые сборки (если присутствуют в репозитории):
- Windows: запустить `barcode_emulator.exe` из корня проекта.

## Сборка .exe (Windows)

```bash
pyinstaller --noconfirm --onefile --windowed --name barcode_emulator --icon app.ico emu/main.py
```

Итоговый файл будет в каталоге `dist/`.

Подсказки по сборке:
- Иконка `app.ico` опциональна (можно убрать параметр `--icon`).
- Если используете системный Python, убедитесь, что `pip show pyinstaller` установлен в том же окружении.

## Где хранятся настройки

Настройки не записываются рядом с приложением, а сохраняются в профиле пользователя:
- Windows: `%APPDATA%/barcode_emulator`
- macOS: `~/Library/Application Support/barcode_emulator`
- Linux: `~/.config/barcode_emulator`

Файлы:
- `scanner_config.json` — переопределения параметров сканирования (создаётся только при отличиях от умолчаний);
- `ui_theme.json` — выбранная тема (`dark` или `light`).

## Параметры сканирования
Доступны через «Параметры → Параметры сканирования»:

```text
initial_delay     — задержка перед началом эмуляции (сек)
first_char_delay  — дополнительная задержка перед первым символом (сек)
char_delay        — задержка между символами (сек)
key_hold_delay    — время «удержания» клавиши (сек)
max_length        — максимальная допустимая длина кода
```

Значения по умолчанию заданы в `emu/config.py` (`SCANNER_CONFIG_DEFAULT`).

## Технические детали
- Эмуляция ввода: модуль `emu/scanner.py` на базе `pynput`.
- UI и логика: `emu/gui.py` (кнопки «Сканировать», «Barcode из файла», «Barcode из снимка экрана»).
- Распознавание изображений: `emu/barcodescannerfile.py` использует `pyrxing.read_barcodes`.
- Темы и оформление: `emu/theme.py` (светлая/тёмная, поддержка тёмного заголовка на Windows 10+).
- Пути к данным пользователя: `emu/paths.py`.

## Поддерживаемые форматы изображений
Диалог выбора файла: `*.png, *.jpg, *.jpeg, *.bmp`.
Для буфера обмена используется изображение, скопированное как bitmap/PNG (например, через «Print Screen» или инструмент «Ножницы» в Windows).

## Частые вопросы

— Не распознаётся код с изображения
1) Убедитесь, что установлен `pyrxing` (см. `requirements.txt`).
2) Попробуйте другое изображение: чётче, без сильного шума/дисторсий.
3) Для буфера обмена: проверьте, что в буфере именно изображение, а не путь к файлу.

— Ничего не «печатается» при нажатии «Сканировать»
1) Проверьте ограничения длины (`max_length`).
2) Дайте окну‑приёмнику фокус (после подтверждения появится 2‑секундная пауза).
3) На некоторых системах могут потребоваться дополнительные разрешения на управление вводом.

## Структура проекта (основное)

```
.
├── app.ico
├── barcode_emulator.exe           # (может отсутствовать) готовая сборка Windows
├── emu/
│   ├── main.py                    # точка входа
│   ├── gui.py                     # основное окно
│   ├── scanner.py                 # эмуляция ввода
│   ├── barcodescannerfile.py      # распознавание из изображений (pyrxing)
│   ├── config.py                  # умолчания и сохранение настроек
│   ├── theme.py                   # темы, тёмный заголовок в Windows
│   └── pages/
│       ├── scan_params.py         # диалог параметров сканирования
│       └── settings_style.py      # диалог выбора темы
├── requirements.txt
└── README.md
```

## Лицензия
Если не указано иное, проект распространяется «как есть» без гарантий. Уточните условия лицензирования под ваши требования.